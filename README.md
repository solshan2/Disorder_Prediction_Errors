# Disorder_Prediction_Errors
 Analytic code for "Making the most of errors: Utilizing erroneous predictions generated by machine learning models of neuroimaging data for capturing disorder heterogeneity"

Scripts should be run in the following order: DataPreparation, Analysis1, Analysis2, Analysis 3, and Visuals.

## Data Preparation 

# 0_1_nifty2numpy_parcellation.py

This script takes the raw Nifti file time series as input. It applies an atlas of the user’s choice and saves the output files as numpy arrays. 

# 0_2_connectome_generation.py

This script reads in all available parcellated fMRI data from the UCLA dataset (ds000030) and saves them as functional connectomes.

# 0_3_consolidate_connectomes.py

This script extracts the unique values from each subject’s functional connectivity matrix and appends them all into a singular dataframe for analysis. 

# 0_4_phenotype_consolidation.py

This script extracts information for each subject's responses to the SANS, SAPS, and BipolarII scales. 

## Analysis 1 

# 1_1_prediction_generation.py 

This script fits and runs the support vector classifier model on subjects in the training set and tests on the held out subjects. It also saves the confusion matrix of the results of the classification. 

# 1_2_hyperparameter_evaluation.py 

This script evaluates accuracy as a result of different combinations of hyperparameters for the support vector machine. 

# 1_3_permutation_testing.py 

This script runs the permutations for each of the different cells in the confusion matrix (for each correct classification and misclassification).

## Analysis 2 

# 2_1_individual_differences_regression.Rmd 

This script performs backward stepwise regression and runs regression analysis with the final models for SAPS, SANS, and BipolarII

## Analysis 3 

# 3_1_network_permutation_testing.py 

This script runs permutation testing over the 7 networks from Yeo et al. (2011) for each cell of the confusion matrix (for each correct classification and misclassification). 

# 3_2_feature_importance_t-tests.Rmd 

This script compares the classification/misclassification rates of the models with specific network edges permuted versus randomly permuted collections of edges of the same size.

## Visuals 

# 1_v1_confusion_matrix_visual.py 

Creates Figure 2 in the manuscript: Confusion matrix of observed classification and misclassification rates. 

# 1_v2_permutation_testing_visuals.ipynb 

Creates Figure 3 in the manuscript: The observed classifications and misclassifications (red lines) overlaid on their distributions from permutation testing. 

# 3_v2_effect_size_visuals.ipynb 

Creates Figure 5 in the manuscript: Cohen’s d effect-size values for t-tests of network permutation results.  

# 3_v3_network_permutation_testing_visuals.ipynb

Creates Figure 4: Distributions of classification and misclassification when edges associated with each of the 7 networks from Yeo et al. (2011) were permuted (colored distributions) and randomly selected other sets of edges were permuted for comparison (black distributions). 

